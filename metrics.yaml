filters:
  amazon-gateway-events:
    event: Spreetail_BD_ATM_Feed
    nrql: WHERE appName IN ('Catalog.Gateways.Amazon', 'Catalog.Gateways.Amazon') AND Marketplace = 'Amazon'
  amazon-orders:
    extend:
      filter: amazon-gateway-events
      with: AND Feed_Type = 'SaveOrderSingle'
  amazon-successful-orders:
    extend:
      filter: amazon-orders
      with: AND Feed_Status = 'Success'

output-selections:
  single-orders:
    nrql: SELECT COUNT(*) AS `Orders Ingested`
  feed-error-rate:
    percentage:
        function: COUNT(*)
        filter: Feed_Status != 'Success'

display:
  timeseries-by-feedtype:
    facet: Feed_Type LIMIT 30
    display: TIMESERIES

queries:
  amazon-new-orders:
    input: amazon-successful-orders
    output: single-orders
  amazon-feed-error-rate:
    input: amazon-gateway-events
    output: feed-error-percentage
    display: timeseries-by-feedtype

